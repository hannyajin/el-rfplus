<html ng-app="storeApp">
  <head>
    <meta charset="utf-8">
    <title>Refill Plus Dashboard</title>

    <style type="text/css">
    </style>

    <link rel="stylesheet" type="text/css" href="css/style.css">

    <!-- Purecss.io -->
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">

    <!-- favicon -->
    <link rel="icon" type="image/png" href="img/favicon.png">

    <script src="//code.jquery.com/jquery-2.0.3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.js"></script>

    <script type="text/javascript" src="js/controllers.js"></script>
  </head>

  <body>

    <img src="img/logo.png">

    <script type="text/javascript">
      
    </script>

    <div ng-controller="AddStoreCtrl">
      <form class="pure-form pure-form-aligned" ng-submit="addStore()">
        <fieldset>
          <legend>Add Store</legend>

          <div class="pure-control-group">
            <label for="name">Store Name</label>
            <input id="name" ng-model="name" type="text" placeholder="Name">
          </div>

          <div class="pure-control-group">
            <label for="address">Address</label>
            <input id="address" ng-model="address" type="text" placeholder="Address">
          </div>

          <div class="pure-control-group">
            <label for="phone">Phone</label>
            <input id="phone" ng-model="phone" type="text" placeholder="Phone">
          </div>

          <div class="pure-control-group">
            <label for="email">Email</label>
            <input id="email" ng-model="email" type="email" placeholder="Email">
          </div>

          <div class="pure-control-group">
            <label for="fax">Fax</label>
            <input id="fax" ng-model="fax" type="text" placeholder="Fax">
          </div>

          <div class="pure-control-group">

            <div id="logo_div">

              <label for="logo_drag_uploader">Drag to upload</label>
              <div id="logo_drag_uploader">
                <img id="logo_preview" src="">
              </div>

              <p id="upload_fallback">
                <label for="upload_fallback">Select logo from file</label>
                <input type="file">
              </p>

              <div>
                <label for="logo_url_sel">Select logo from URL</label>
                <input id="logo_url_sel" ng-model="logo_url" type="text" placeholder="logo url">
                <!--<input id="logo_selector" ng-model="logo" type="file" accept="image/*">-->
              </div>

            </div>

          </div>

          <div class="pure-control-group">
            <label>Location</label>
            <input ng-model="longitude" type="text" placeholder="longitude">
            <input ng-model="latitude" type="text" placeholder="latitude">
          </div>

          <br>
            <button type="submit" class="pure-button pure-button-primary">Submit</button>

        </fieldset>
      </form>
    </div>

    <script type="text/javascript">
      var nodragUploader = $('#upload_fallback')[0];

      var draggable = ('draggable' in document.createElement('span') && true);

      if (draggable) { // check if drag enabled
        var drag = $('#logo_drag_uploader');
        drag[0].ondragover = function () {
          console.log("dragstart");
          drag.addClass('logo_hover');
          return false;
        };

        drag[0].ondragleave = function () {
          console.log("dragleave");
          drag.removeClass('logo_hover');
          return false;
        };

        drag[0].ondrop = function (e) {
          e.preventDefault();
          console.log("dropped");
          drag.removeClass('logo_hover');
          readFiles(e.dataTransfer.files);
          return false;
        };

      } else { // draggable
        console.log("No drag support");
      }

      // logo file selector
      nodragUploader.querySelector('input').onchange = function () {
        readFiles(this.files);
      }
      // logo url selector
      $('#logo_url_sel')[0].onchange = function () {
        var p = $('#logo_preview')[0];
        p.src = $scope.logo_url;
      }

      // read files
      function readFiles (files) {
        console.log("READ FILES");
        console.log(files);

        // preview the image (first only)
        var file = files[0];
        previewFile(file);

      }

      function previewFile (file) {
        var p = $('#logo_preview')[0];
        var reader = new FileReader();
        reader.onload = function (e) {
          p.src = e.target.result;
        }
        reader.readAsDataURL(file);
      }

    </script>

  </body>
</html>